# 刷卡操作测试
# 严格按照《设备对接指引-组网设备2024(1).txt》第2.2.9-2.2.10节构建

name: "刷卡操作测试"
description: "验证刷卡充电和余额查询的完整流程"
category: "card"
version: "1.0"  
author: "Protocol Validation System"
created_at: "2024-12-25T00:00:00Z"

scenarios:
  - id: "card_charging_online_001"
    name: "在线卡刷卡充电"
    description: "使用在线卡片进行刷卡充电的完整流程"
    type: "uplink"
    
    input:
      hex_frame: "fcfe003210050000000000018220052000486904010110050a01020000000000000000090103822005200048691234567890abcdef10fcee"
      scenario: "card_charging_online"
      context:
        card_type: "online"
        card_id: "1234567890abcdef"
        socket_no: 1
        port: "A"
        
    expected:
      command: 0x1005
      direction: 0x01
      gateway_id: "82200520004869"
      frame_type: "bkv_card_charging"
      valid: true
      
    assertions:
      - field: "command"
        type: "equals"
        value: 0x1005
        message: "刷卡充电命令必须为0x1005"
        required: true
        
      - field: "direction"
        type: "equals"
        value: 0x01
        message: "上行帧方向必须为0x01"
        required: true

    bkv_assertions:
      - field: "bkv_command"
        type: "equals"
        value: 0x1005
        message: "BKV刷卡充电命令必须为0x1005"
        
      - field: "card_id"
        type: "valid"
        message: "卡片ID必须有效"
        
      - field: "socket_no"
        type: "equals"
        value: 1
        message: "插座号必须正确"

    metadata:
      protocol_version: "1.7"
      bkv_protocol: true
      card_type: "online"
      operation: "charging"
      
  - id: "card_balance_query_001"
    name: "刷卡查询余额"
    description: "使用卡片查询账户余额"
    type: "uplink"
    
    input:
      hex_frame: "fcfe002810060000000000018220052000486904010110060a010200000000000000009010382200520004869fcee"
      scenario: "card_balance_query"
      context:
        card_id: "1234567890abcdef"
        socket_no: 1
        
    expected:
      command: 0x1006
      direction: 0x01
      valid: true
      
    assertions:
      - field: "command"
        type: "equals"
        value: 0x1006
        message: "查询余额命令必须为0x1006"
        required: true

    bkv_assertions:
      - field: "bkv_command" 
        type: "equals"
        value: 0x1006
        message: "BKV查询余额命令必须为0x1006"

    metadata:
      protocol_version: "1.7"
      bkv_protocol: true
      operation: "balance_query"
      
  - id: "card_charging_response_001"
    name: "刷卡充电平台回复"
    description: "平台对刷卡充电请求的回复"
    type: "downlink"
    
    input:
      hex_frame: "fcff002610050000001234568220052000486904010110050a010200000001000000009010382200520004869fcee"
      scenario: "card_charging_response"
      
    expected:
      command: 0x1005
      direction: 0x00
      sequence: 0x00001234
      valid: true
      
    assertions:
      - field: "command"
        type: "equals"
        value: 0x1005
        message: "充电回复命令必须为0x1005"
        required: true
        
      - field: "sequence"
        type: "not_zero"
        message: "平台回复帧序列号不能为0"
        required: true

    metadata:
      protocol_version: "1.7"
      bkv_protocol: true
      response_type: "charging_authorization"