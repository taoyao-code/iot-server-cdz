# 充电控制测试
# 严格按照《设备对接指引-组网设备2024(1).txt》第2.2.4节构建

name: "充电控制测试"
description: "验证按时/按量/按功率充电控制的完整流程"
category: "basic"
version: "1.0"
author: "Protocol Validation System"
created_at: "2024-12-25T00:00:00Z"

scenarios:
  - id: "control_time_charging_001"
    name: "按时充电控制"
    description: "控制2号插座A孔按时充电240分钟"
    type: "downlink"
    
    input:
      hex_frame: "fcff001c0015001c9a5100860044594530050008070200010100f00000c8fcee"
      scenario: "time_charging_control"
      context:
        socket_no: 2
        port: "A"
        charging_mode: "by_time"
        duration_minutes: 240
        
    expected:
      command: 0x0015
      direction: 0x00
      gateway_id: "44594530050008"
      frame_type: "control_command"
      valid: true
      
    assertions:
      - field: "header"
        type: "equals"
        value: 0xfcff
        message: "下行帧头必须为0xfcff"
        required: true
        
      - field: "command"
        type: "equals"
        value: 0x0015
        message: "控制命令码必须为0x0015"
        required: true
        
      - field: "direction"
        type: "equals"
        value: 0x00
        message: "下行帧方向必须为0x00"
        required: true

    bkv_assertions:
      - field: "socket_no"
        type: "equals"
        value: 2
        message: "插座序号必须为2"
        
      - field: "charging_mode"
        type: "equals"
        value: "time"
        message: "充电模式必须为按时充电"

    metadata:
      protocol_version: "1.7"
      bkv_protocol: true
      control_type: "time_charging"
      
  - id: "control_power_charging_001"
    name: "按电量充电控制"
    description: "控制插座按电量充电"
    type: "downlink"
    
    input:
      hex_frame: "fcff001a0015001a9a51008600445945300500080702000101000a0064fcee"
      scenario: "power_charging_control"
      
    expected:
      command: 0x0015
      direction: 0x00
      valid: true
      
    assertions:
      - field: "header"
        type: "equals"
        value: 0xfcff
        message: "下行帧头必须为0xfcff"
        required: true
        
      - field: "command"
        type: "equals"
        value: 0x0015
        message: "控制命令码必须为0x0015"
        required: true

    bkv_assertions:
      - field: "charging_mode"
        type: "equals"
        value: "power"
        message: "充电模式必须为按电量充电"

    metadata:
      protocol_version: "1.7"
      bkv_protocol: true
      control_type: "power_charging"