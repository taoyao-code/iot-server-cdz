# 测试用例数据格式规范
# 此文件定义了协议验证测试体系中测试用例的标准格式

# 完整测试用例示例
name: "心跳上报/回复测试"
description: "验证设备心跳上报和平台回复的完整流程"
category: "basic"           # basic, advanced, edge-cases
version: "1.0"
author: "Protocol Validation System"
created_at: "2024-01-01T00:00:00Z"

# 测试场景列表
scenarios:
  - id: "heartbeat_uplink_001"
    name: "网关心跳上报"
    description: "网关心跳上报，包含ICCID和信号强度"
    type: "uplink"            # uplink, downlink, bidirectional
    priority: "high"          # high, medium, low
    timeout: "30s"
    
    # 测试输入
    input:
      hex_frame: "fcfe002e00000000000001822005200048693839383630343633313132303730333139343137635662e31723436001fcafcee"
      scenario: "device_heartbeat"
      context:
        device_online: true
        network_status: "connected"
    
    # 期望结果
    expected:
      command: 0x0000
      direction: 0x01
      gateway_id: "82200520004869"
      frame_type: "heartbeat_uplink"
      valid: true
      payload:
        iccid: "89860463112070319417"
        signal_strength: 31
        checksum_valid: true
      ack_behavior: "required"    # required, optional, none
      response_timeout: "10s"
    
    # 断言列表
    assertions:
      - field: "header"
        type: "equals"
        value: 0xfcfe
        message: "上行帧头必须为0xfcfe"
        required: true
        
      - field: "length"
        type: "equals" 
        value: 0x002e
        message: "帧长度必须与声明长度一致"
        required: true
        
      - field: "command"
        type: "equals"
        value: 0x0000
        message: "心跳命令码必须为0x0000"
        required: true
        
      - field: "sequence"
        type: "equals"
        value: 0x00000000
        message: "设备主动上报帧流水号必须为0"
        required: true
        
      - field: "direction"
        type: "equals"
        value: 0x01
        message: "上行帧方向必须为0x01"
        required: true
        
      - field: "gateway_id"
        type: "equals"
        value: "82200520004869"
        message: "网关ID必须与预期一致"
        required: true
        
      - field: "checksum"
        type: "valid"
        message: "校验和必须正确"
        required: true
        
      - field: "tail"
        type: "equals"
        value: 0xfcee
        message: "帧尾必须为0xfcee"
        required: true

    # BKV协议特定断言（如果适用）
    bkv_assertions:
      - field: "iccid"
        type: "pattern"
        pattern: "^[0-9]{20}$"
        message: "ICCID必须为20位数字"
        
      - field: "signal_strength"
        type: "range"
        min: 0
        max: 31
        message: "信号强度范围必须在0-31之间"

    # 元数据
    metadata:
      protocol_version: "1.7"
      device_type: "gateway"
      test_environment: "simulation"
      related_scenarios: ["heartbeat_downlink_001"]