# 风险与阻塞（仅"组网设备"协议）

## 当前Top风险
- 校验和与长度边界
  - 影响：误判报文、ACK无法匹配
  - 缓解：先用"逐字节和 mod 256"可配置；联调抓包校对；错误包HEX审计
- 文档/设备实现差异
  - 影响：字段/命令值不一致导致解析失败
  - 缓解：以文档样例驱动单测；差异记录"方言映射"
- ACK 与幂等
  - 影响：乱序/重发导致重复执行
  - 缓解：唯一键(device_id, seq)；出站状态机严格转换；死信审计
- 刷卡余额来源
  - 影响：余额应答缺失
  - 缓解：临时配置/回环接口；上层对接后切换
- 参数持久化一致性
  - 影响：参数设置丢失/错配
  - 缓解：DB 化 params_pending；写后待ACK确认；冷启恢复

## 依赖与前置
- 与设备侧确认：校验算法、关键命令/字段边界、异常原因码全集
- 抓包样本：覆盖心跳/状态/控制/结束/参数/异常/OTA典型流