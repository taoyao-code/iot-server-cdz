# 生产环境测试结果记录

## 测试信息

- **测试日期:** ___________
- **测试人员:** ___________
- **测试环境:** 182.43.177.92
- **设备ID:** 82210225000520, 82241218000382

## 第一阶段：环境验证与准备

### 1.1 服务器健康检查

| 检查项 | 预期 | 实际 | 状态 |
|--------|------|------|------|
| healthz接口 | 200 OK | ____ | ☐ |
| readyz接口 | 200 OK | ____ | ☐ |
| 容器状态 | Running | ____ | ☐ |
| 日志状态 | 无ERROR | ____ | ☐ |

**备注:** _______________________________

### 1.2 设备在线状态

| 设备ID | 在线状态 | 最后心跳时间 | 备注 |
|--------|----------|--------------|------|
| 82210225000520 | ☐ 在线 ☐ 离线 | _________ | ____ |
| 82241218000382 | ☐ 在线 ☐ 离线 | _________ | ____ |

**备注:** _______________________________

### 1.3 Webhook配置

- [ ] Webhook URL已配置: ___________________
- [ ] Webhook密钥已配置
- [ ] Webhook连通性测试通过
- [ ] 接收端点已部署

**备注:** _______________________________

### 1.4 API认证

- [ ] API Key验证通过
- [ ] API调用正常
- [ ] 返回数据格式正确

**备注:** _______________________________

---

## 第二阶段：基础充电流程测试

### 测试用例 2.1: 按时长充电

**测试时间:** ___________ 到 ___________

**订单信息:**

- 订单号: _______________________
- 设备: 82210225000520
- 端口: 1
- 目标时长: 300秒
- 目标金额: 500分

**测试步骤记录:**

| 步骤 | 检查项 | 预期 | 实际 | 状态 |
|------|--------|------|------|------|
| 1 | API调用 | 200 | ____ | ☐ |
| 2 | 订单创建 | pending | ____ | ☐ |
| 3 | 指令下发 | 0x82 sent | ____ | ☐ |
| 4 | 插入插头 | 指示灯亮 | ____ | ☐ |
| 5 | 订单确认 | charging | ____ | ☐ |
| 6 | 充电进度 | 每11秒更新 | ____ | ☐ |
| 7 | 充电结束 | completed | ____ | ☐ |
| 8 | 时长误差 | ≤5秒 | ____秒 | ☐ |

**充电进度数据记录:**

| 时间 | 时长(秒) | 电量(度) | 功率(W) | 状态 |
|------|----------|----------|---------|------|
| **:** | ____ | ____ | ____ | ____ |
| **:** | ____ | ____ | ____ | ____ |
| **:** | ____ | ____ | ____ | ____ |

**最终结算数据:**

- 实际时长: _______秒
- 实际电量: _______度
- 最终金额: _______分
- 结束原因: _______
- 峰值功率: _______W

**Webhook事件接收:**

- [ ] charging.started
- [ ] charging.progress (____次)
- [ ] order.completed

**测试结果:** ☐ 通过 ☐ 失败

**问题记录:** _______________________________

---

### 测试用例 2.2: 远程停止充电

**测试时间:** ___________ 到 ___________

**订单信息:**

- 订单号: _______________________
- 充电时长: 约120秒后停止

**测试记录:**

| 步骤 | 检查项 | 预期 | 实际 | 状态 |
|------|--------|------|------|------|
| 1 | 启动充电 | 成功 | ____ | ☐ |
| 2 | 等待2分钟 | charging | ____ | ☐ |
| 3 | 调用停止API | 200 | ____ | ☐ |
| 4 | 设备停止 | 指示灯灭 | ____ | ☐ |
| 5 | 订单结算 | completed | ____ | ☐ |
| 6 | 时长验证 | ≈120秒 | ____秒 | ☐ |
| 7 | 结束原因 | 远程停止(3) | ____ | ☐ |

**测试结果:** ☐ 通过 ☐ 失败

**问题记录:** _______________________________

---

## 第三阶段：异常场景测试

### 测试用例 3.1: 充电中设备断网

**测试时间:** ___________

**测试记录:**

| 步骤 | 操作 | 预期结果 | 实际结果 | 状态 |
|------|------|----------|----------|------|
| 1 | 启动充电 | 成功 | ____ | ☐ |
| 2 | 充电2分钟 | 正常 | ____ | ☐ |
| 3 | 断开网络 | 30秒后离线 | ____秒 | ☐ |
| 4 | 设备本地充电 | 继续 | ____ | ☐ |
| 5 | 恢复网络 | 5-10秒重连 | ____秒 | ☐ |
| 6 | 数据同步 | 包含离线数据 | ____ | ☐ |

**测试结果:** ☐ 通过 ☐ 失败

**问题记录:** _______________________________

---

### 测试用例 3.2: 端口占用冲突

**测试记录:**

| 检查项 | 预期 | 实际 | 状态 |
|--------|------|------|------|
| 第一次充电 | 成功 | ____ | ☐ |
| 第二次充电(同端口) | 409错误 | ____ | ☐ |
| 错误信息 | port is busy | ____ | ☐ |

**测试结果:** ☐ 通过 ☐ 失败

---

### 测试用例 3.3: 多端口并发充电

**测试时间:** ___________

**测试记录:**

| 端口 | 订单号 | 状态 | 时长 | 电量 | 备注 |
|------|--------|------|------|------|------|
| 1 | _______ | ____ | ____ | ____ | ____ |
| 2 | _______ | ____ | ____ | ____ | ____ |
| 3 | _______ | ____ | ____ | ____ | ____ |
| 4 | _______ | ____ | ____ | ____ | ____ |

**验证项:**

- [ ] 4个订单同时创建
- [ ] 4个端口独立工作
- [ ] 数据互不干扰
- [ ] 总功率合理

**测试结果:** ☐ 通过 ☐ 失败

---

## 第四阶段：性能与压力测试

### 4.1 API并发测试

**测试工具:** Apache Bench

**测试参数:**

- 请求总数: 1000
- 并发数: 10
- 目标设备: 82210225000520

**测试结果:**

| 指标 | 预期 | 实际 | 状态 |
|------|------|------|------|
| 成功率 | >99% | ____% | ☐ |
| 平均响应时间 | <200ms | ____ms | ☐ |
| QPS | >50 | ____ | ☐ |
| 错误率 | <1% | ____% | ☐ |

**详细数据:**

```
总请求数: ____
成功: ____
失败: ____
最小响应时间: ____ms
最大响应时间: ____ms
平均响应时间: ____ms
P50: ____ms
P95: ____ms
P99: ____ms
```

**测试结果:** ☐ 通过 ☐ 失败

---

### 4.2 心跳处理性能

**活跃设备数:** ____
**心跳频率:** 11秒/次
**CPU使用率:** ____%
**内存使用:** ____MB

**测试结果:** ☐ 通过 ☐ 失败

---

### 4.3 数据库性能

**慢查询数量:** ____
**最慢查询时间:** ****ms
**数据库连接池:** 使用****/最大____

**表大小:**

- devices: ____
- orders: ____
- cmd_logs: ____

**测试结果:** ☐ 通过 ☐ 失败

---

## 第五阶段：数据一致性验证

### 5.1 订单完整性

- 孤立订单数: ____ (预期: 0)
- 长时间未完成订单: ____ (预期: 0)

**测试结果:** ☐ 通过 ☐ 失败

---

### 5.2 命令日志一致性

- 下行命令数: ____
- 上行响应数: ____
- 匹配率: ____%

**测试结果:** ☐ 通过 ☐ 失败

---

### 5.3 端口状态一致性

- 检查端口数: ____
- 状态一致: ____
- 状态不一致: ____

**测试结果:** ☐ 通过 ☐ 失败

---

## 第六阶段：监控验证

### 6.1 Prometheus指标

- [ ] tcp_connections_accepted_total: ____
- [ ] active_sessions: ____
- [ ] orders_created_total: ____
- [ ] orders_settled_total: ____
- [ ] outbound_messages_sent_total: ____

**测试结果:** ☐ 通过 ☐ 失败

---

### 6.2 日志完整性

**日志级别分布:**

- info: ____
- warn: ____
- error: ____

**测试结果:** ☐ 通过 ☐ 失败

---

### 6.3 事件推送成功率

- 事件队列积压: ____ (预期: <10)
- 推送成功率: ____% (预期: >99%)
- 平均推送延迟: ____ms

**测试结果:** ☐ 通过 ☐ 失败

---

## 最终验收总结

### 功能完整性

- [ ] 设备上线注册和心跳
- [ ] 充电指令下发成功
- [ ] 订单创建和确认
- [ ] 充电进度实时上报
- [ ] 订单正常结算
- [ ] 远程停止充电
- [ ] 第三方Webhook推送
- [ ] 异常场景恢复

**完成度:** ****/8 (****%)

---

### 数据准确性

- [ ] 充电时长误差 < 5秒
- [ ] 电量计量合理
- [ ] 金额计算正确
- [ ] 数据无丢失

**完成度:** ****/4 (****%)

---

### 可靠性

- [ ] 设备断线重连 < 10秒
- [ ] 指令下发成功率 > 99%
- [ ] API响应时间 < 200ms
- [ ] Webhook推送成功率 > 99%

**完成度:** ****/4 (****%)

---

### 性能指标

- [ ] 支持100+ QPS
- [ ] 并发连接 > 100
- [ ] 内存使用 < 2GB
- [ ] CPU使用 < 50%

**完成度:** ****/4 (****%)

---

## 问题汇总

| 编号 | 问题描述 | 严重程度 | 发现阶段 | 状态 | 备注 |
|------|----------|----------|----------|------|------|
| 1 | | P0/P1/P2 | | 待修复/已修复 | |
| 2 | | | | | |
| 3 | | | | | |

---

## 测试结论

**总体评分:** ____/100

**是否通过验收:** ☐ 是 ☐ 否

**建议:**
_______________________________
_______________________________
_______________________________

**测试人签名:** ___________
**审核人签名:** ___________
**日期:** ___________
