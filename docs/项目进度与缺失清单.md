# 项目进度与缺失清单（IoT 充电桩平台）

更新时间：2025-09-12

## 已完成（核心纵切）

- 接入与基础设施：HTTP/TCP、配置(viper)、日志(zap+lumberjack)、指标(Prometheus)、Mux 多协议首帧初判
- 协议：AP3000 最小闭环（20/21/22/12/82/03/06 解析/处理/路由），BKV 适配器骨架与回放用例
- 会话：心跳维持在线判定、绑定设备到连接；多信号骨架（TCP 断开/ACK 超时），加权策略（可配）
- 持久化：PG 连接池与首批迁移（devices/ports/orders/cmd_log/outbound_queue）
- 出站：outbound worker（冷启扫描、ACK 超时退避、重试/置 dead、dead 清理、按协议编码、节流）
- 管理接口：只读 API（设备/端口查询）
- 文档与 CI：实施/架构/计划文档体系，OpenAPI 草案，基础 CI

## 缺失模块（形成完整平台所需，协议优先：BKV > AP3000）

- 协议插件
  - BKV（优先）：
    - 控制/参数：细化字段解析、参数写入→回读校验的最小闭环；更多单测用例
    - 结束原因映射：统一枚举与错误码字典；日志/审计一致性
  - AP3000（延后）：
    - 参数 83/84/85 最小子集；升级 E0/F8 编解码与回读校验（骨架）

- 出站链路
  - 幂等与去重：`correlation_id` 约束与用例；冷启续发语义校验

- 会话与路由
  - 加权策略调参与阈值验证；在线/离线原因观测固化

- 观测（并行，不抢占主线）
  - 告警清单固化（PrometheusRule/Alertmanager），Grafana 面板模板

## 近期优先（M1，严格按 BKV>AP3000）

1) BKV 控制/参数最小闭环：解析→落库→回读校验→单测
2) 出站幂等与去重：定义与验证 `correlation_id`、回放用例
3) AP3000 参数/升级（延后开始）：83/84/85、E0/F8 骨架
4) 会话与观测：加权策略调参、告警清单落库（并行）

## 对齐文档

- 计划：会话与路由、协议插件、持久化-PG、接入网关、第三方对接、管理与观测
- 架构：架构设计、会话与路由、协议插件、持久化-PG、接入网关
