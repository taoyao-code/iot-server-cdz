# 代码仓库与结构

## 仓库入口

- 可执行程序：`cmd/server/main.go`
- 配置：`configs/example.yaml`（以 ENV 覆盖敏感项）
- OpenAPI：`api/openapi/openapi.yaml`
- 数据库迁移：`db/migrations/`

## 主要目录

- `internal/httpserver`：HTTP 封装（/healthz /readyz /metrics）
- `internal/tcpserver`：TCP 网关（连接上下文、读写分离）
- `internal/protocol/ap3000`：AP3000 编解码/路由
- `internal/protocol/bkv`：BKV 协议骨架（fcfe/fcff 判别与解码）
- `internal/outbound`：下行队列 Worker（WAL/ACK/重试）
- `internal/storage/pg`：PG 连接与仓储
- `internal/thirdparty`：第三方推送签名与推送器

## 启动方式

```bash
IOT_CONFIG=./configs/example.yaml go run ./cmd/server
```

## 备注

- 多协议分流：在 `cmd/server/main.go` 的 TCP 处理器内，按首帧判别 AP3000 与 BKV。
- 指标：Prometheus 暴露于 `/metrics`，具体见 `internal/metrics`。
