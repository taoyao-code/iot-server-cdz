## 接入网关 · 实施清单

### TODO

- [ ] 接入驱动初始化（标准库 net）：监听/优雅关闭/accept 循环
- [ ] 首帧识别与路由（BKV: fcfe/fcff；AP3000: DNY/link/SIM）
- [ ] 粘/半包帧状态机（SYNC→LEN→BODY→CHK），校验与错误码
- [ ] 单设备下行队列（优先级：控制>心跳）、合并写、节流≥500ms
- [ ] 超时15s、≤1次重发、dead 队列审计、冷启续发扫描
- [ ] 指标与日志（连接数、解析失败率、端到端p99、队列、重发率；HEX审计）
- [ ] 配置键接入（gateway.*, ratelimit.*），白名单（IP/设备）

### M0 目标（纵切）

- [ ] 接入 AP3000：DNY 解析、ICCID/link、20/21/22 识别
- [ ] 82/03/06 最小闭环打通（消息ID回显、错误码）
- [ ] 指标：连接数、解析失败率、82 成功率、端到端 p99

### M1 目标（扩展）

- [ ] 增加 BKV 首帧识别与路由；错误码字典统一化
- [ ] 死链回收、优先级队列与节流细化；冷启续发与审计面板

### 验收

- 粘/半包/错校验/越界用例100%通过；控制路径 p99 ≤200ms
- 冷启续发成功≥99%；重发率≤1%；限速生效且不影响关键指令

### Owner

- 待指派（网关负责人）

### 依赖

- 协议插件接口、PG outbound_queue、技术栈治理标签 [TS-Config]/[TS-Log]/[TS-Metrics]

### 风险/缓解

- 阻塞点遗漏→有界工作池；队列积压→背压与丢弃非关键包；内核参数调优
